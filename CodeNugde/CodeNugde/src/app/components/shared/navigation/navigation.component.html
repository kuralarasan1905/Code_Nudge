<!-- Navigation Header -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
  <div class="container-fluid">
    <!-- Brand -->
    <a class="navbar-brand d-flex align-items-center" routerLink="/">
      <i class="bi bi-code-square me-2 fs-4"></i>
      <span class="fw-bold">CodeNudge</span>
    </a>

    <!-- Mobile toggle button -->
    <button 
      class="navbar-toggler" 
      type="button" 
      (click)="toggleSidebar()"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Navigation items -->
    <div class="collapse navbar-collapse" [class.show]="!isCollapsed()">
      <ul class="navbar-nav me-auto">
        @for (item of getNavigationItems(); track item.route) {
          <li class="nav-item" [class.dropdown]="item.children">
            @if (item.children) {
              <!-- Dropdown menu -->
              <a 
                class="nav-link dropdown-toggle"
                [class.active]="hasActiveChild(item)"
                href="#" 
                role="button" 
                data-bs-toggle="dropdown"
              >
                <i [class]="item.icon" class="me-1"></i>
                {{ item.label }}
                @if (item.badge) {
                  <span class="badge bg-danger ms-1">{{ item.badge }}</span>
                }
              </a>
              <ul class="dropdown-menu">
                @for (child of item.children; track child.route) {
                  <li>
                    <a 
                      class="dropdown-item"
                      [routerLink]="child.route"
                      routerLinkActive="active"
                    >
                      <i [class]="child.icon" class="me-2"></i>
                      {{ child.label }}
                    </a>
                  </li>
                }
              </ul>
            } @else {
              <!-- Regular nav link -->
              <a 
                class="nav-link"
                [routerLink]="item.route"
                routerLinkActive="active"
              >
                <i [class]="item.icon" class="me-1"></i>
                {{ item.label }}
                @if (item.badge) {
                  <span class="badge bg-danger ms-1">{{ item.badge }}</span>
                }
              </a>
            }
          </li>
        }
      </ul>

      <!-- Right side items -->
      <ul class="navbar-nav">
        <!-- Notifications -->
        <li class="nav-item dropdown">
          <a 
            class="nav-link position-relative"
            href="#"
            role="button"
            (click)="toggleNotifications()"
            [class.show]="showNotifications()"
          >
            <i class="bi bi-bell fs-5"></i>
            @if (unreadCount() > 0) {
              <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                {{ unreadCount() }}
              </span>
            }
          </a>
          
          <!-- Notifications dropdown -->
          @if (showNotifications()) {
            <div class="dropdown-menu dropdown-menu-end show notifications-dropdown">
              <div class="dropdown-header d-flex justify-content-between align-items-center">
                <span>Notifications</span>
                @if (unreadCount() > 0) {
                  <button 
                    class="btn btn-sm btn-link p-0 text-primary"
                    (click)="markAllNotificationsAsRead()"
                  >
                    Mark all read
                  </button>
                }
              </div>
              
              @if (notifications().length === 0) {
                <div class="dropdown-item-text text-center py-3">
                  <i class="bi bi-bell-slash text-muted fs-4"></i>
                  <p class="text-muted mb-0 mt-2">No notifications</p>
                </div>
              } @else {
                @for (notification of notifications(); track notification.id) {
                  <a 
                    class="dropdown-item notification-item"
                    [class.unread]="!notification.isRead"
                    href="#"
                    (click)="markNotificationAsRead(notification.id)"
                  >
                    <div class="d-flex">
                      <div class="flex-shrink-0 me-2">
                        <i [class]="getNotificationIcon(notification.type)"></i>
                      </div>
                      <div class="flex-grow-1">
                        <div class="fw-semibold">{{ notification.title }}</div>
                        <div class="text-muted small">{{ notification.message }}</div>
                        <div class="text-muted small">{{ notification.time }}</div>
                      </div>
                    </div>
                  </a>
                }
              }
              
              <div class="dropdown-divider"></div>
              <a class="dropdown-item text-center" href="#">
                View all notifications
              </a>
            </div>
          }
        </li>

        <!-- User menu -->
        @if (currentUser()) {
          <li class="nav-item dropdown">
            <a 
              class="nav-link dropdown-toggle d-flex align-items-center"
              href="#"
              role="button"
              (click)="toggleUserMenu()"
              [class.show]="showUserMenu()"
            >
              <img 
                [src]="currentUser()!.avatar" 
                [alt]="currentUser()!.name"
                class="rounded-circle me-2"
                width="32"
                height="32"
              >
              <span class="d-none d-md-inline">{{ currentUser()!.name }}</span>
            </a>
            
            <!-- User dropdown -->
            @if (showUserMenu()) {
              <div class="dropdown-menu dropdown-menu-end show">
                <div class="dropdown-header">
                  <div class="fw-semibold">{{ currentUser()!.name }}</div>
                  <div class="text-muted small">{{ currentUser()!.email }}</div>
                </div>
                <div class="dropdown-divider"></div>
                
                <a class="dropdown-item" href="#" (click)="navigateToProfile()">
                  <i class="bi bi-person me-2"></i>
                  Profile
                </a>
                
                <a class="dropdown-item" href="#" (click)="navigateToSettings()">
                  <i class="bi bi-gear me-2"></i>
                  Settings
                </a>
                
                <div class="dropdown-divider"></div>
                
                <a class="dropdown-item text-danger" href="#" (click)="logout()">
                  <i class="bi bi-box-arrow-right me-2"></i>
                  Logout
                </a>
              </div>
            }
          </li>
        } @else {
          <!-- Login/Register buttons for non-authenticated users -->
          <li class="nav-item">
            <a class="nav-link" routerLink="/auth/login">Login</a>
          </li>
          <li class="nav-item">
            <a class="btn btn-outline-light btn-sm ms-2" routerLink="/auth/register">
              Sign Up
            </a>
          </li>
        }
      </ul>
    </div>
  </div>
</nav>

<!-- Backdrop for mobile dropdowns -->
@if (showUserMenu() || showNotifications()) {
  <div class="dropdown-backdrop" (click)="closeDropdowns()"></div>
}
