<!-- Interview Monitoring -->
<div class="interview-monitoring">
  <div class="container-fluid">
    <!-- Header -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h1 class="h3 mb-0">Interview Monitoring</h1>
            <p class="text-muted mb-0">Monitor and manage interview sessions</p>
          </div>
          <div class="d-flex gap-2">
            <button class="btn btn-outline-primary" (click)="exportInterviews()">
              <i class="bi bi-download me-2"></i>
              Export
            </button>
            <button class="btn btn-primary" (click)="loadInterviews()">
              <i class="bi bi-arrow-clockwise me-2"></i>
              Refresh
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Statistics Cards -->
    <div class="row g-3 mb-4">
      <div class="col-xl-2 col-lg-4 col-md-6">
        <div class="card stat-card">
          <div class="card-body text-center">
            <div class="stat-icon bg-primary">
              <i class="bi bi-clipboard-data text-white"></i>
            </div>
            <h4 class="mb-1">{{ getInterviewStats().total }}</h4>
            <small class="text-muted">Total Interviews</small>
          </div>
        </div>
      </div>
      <div class="col-xl-2 col-lg-4 col-md-6">
        <div class="card stat-card">
          <div class="card-body text-center">
            <div class="stat-icon bg-info">
              <i class="bi bi-calendar-check text-white"></i>
            </div>
            <h4 class="mb-1">{{ getInterviewStats().scheduled }}</h4>
            <small class="text-muted">Scheduled</small>
          </div>
        </div>
      </div>
      <div class="col-xl-2 col-lg-4 col-md-6">
        <div class="card stat-card">
          <div class="card-body text-center">
            <div class="stat-icon bg-warning">
              <i class="bi bi-play-circle text-white"></i>
            </div>
            <h4 class="mb-1">{{ getInterviewStats().inProgress }}</h4>
            <small class="text-muted">In Progress</small>
          </div>
        </div>
      </div>
      <div class="col-xl-2 col-lg-4 col-md-6">
        <div class="card stat-card">
          <div class="card-body text-center">
            <div class="stat-icon bg-success">
              <i class="bi bi-check-circle text-white"></i>
            </div>
            <h4 class="mb-1">{{ getInterviewStats().completed }}</h4>
            <small class="text-muted">Completed</small>
          </div>
        </div>
      </div>
      <div class="col-xl-2 col-lg-4 col-md-6">
        <div class="card stat-card">
          <div class="card-body text-center">
            <div class="stat-icon bg-danger">
              <i class="bi bi-x-circle text-white"></i>
            </div>
            <h4 class="mb-1">{{ getInterviewStats().cancelled }}</h4>
            <small class="text-muted">Cancelled</small>
          </div>
        </div>
      </div>
      <div class="col-xl-2 col-lg-4 col-md-6">
        <div class="card stat-card">
          <div class="card-body text-center">
            <div class="stat-icon bg-secondary">
              <i class="bi bi-graph-up text-white"></i>
            </div>
            <h4 class="mb-1">{{ getInterviewStats().averageScore | number:'1.1-1' }}%</h4>
            <small class="text-muted">Avg Score</small>
          </div>
        </div>
      </div>
    </div>

    <!-- Filters -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="card">
          <div class="card-body">
            <div class="row g-3">
              <div class="col-lg-4 col-md-6">
                <label class="form-label">Search Interviews</label>
                <input 
                  type="text" 
                  class="form-control" 
                  placeholder="Search by title or description..."
                  [(ngModel)]="searchTerm">
              </div>
              <div class="col-lg-2 col-md-6">
                <label class="form-label">Status</label>
                <select class="form-select" [(ngModel)]="selectedStatus">
                  @for (option of statusOptions; track option.value) {
                    <option [value]="option.value">{{ option.label }}</option>
                  }
                </select>
              </div>
              <div class="col-lg-2 col-md-6">
                <label class="form-label">Type</label>
                <select class="form-select" [(ngModel)]="selectedType">
                  @for (option of typeOptions; track option.value) {
                    <option [value]="option.value">{{ option.label }}</option>
                  }
                </select>
              </div>
              <div class="col-lg-4 col-md-6">
                <label class="form-label">&nbsp;</label>
                <div class="d-flex gap-2">
                  <button class="btn btn-outline-secondary" (click)="clearFilters()">
                    <i class="bi bi-x-circle me-1"></i>
                    Clear
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Error Message -->
    @if (error()) {
      <div class="row mb-4">
        <div class="col-12">
          <div class="alert alert-danger" role="alert">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>
            {{ error() }}
          </div>
        </div>
      </div>
    }

    <!-- Loading State -->
    @if (isLoading()) {
      <div class="row">
        <div class="col-12">
          <div class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-3 text-muted">Loading interviews...</p>
          </div>
        </div>
      </div>
    }

    <!-- Interviews List -->
    @if (!isLoading()) {
      <div class="row">
        <div class="col-12">
          <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h5 class="mb-0">Interviews ({{ filteredInterviews().length }})</h5>
              <div class="text-muted">
                Showing {{ filteredInterviews().length }} of {{ interviews().length }} interviews
              </div>
            </div>
            <div class="card-body p-0">
              @if (filteredInterviews().length > 0) {
                <div class="table-responsive">
                  <table class="table table-hover mb-0">
                    <thead class="table-light">
                      <tr>
                        <th>Interview</th>
                        <th>Type</th>
                        <th>Status</th>
                        <th>Scheduled</th>
                        <th>Duration</th>
                        <th>Progress</th>
                        <th>Score</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody>
                      @for (interview of filteredInterviews(); track interview.id) {
                        <tr>
                          <td>
                            <div>
                              <h6 class="mb-1">{{ interview.title }}</h6>
                              <small class="text-muted">{{ interview.description }}</small>
                            </div>
                          </td>
                          <td>
                            <span [class]="getTypeBadgeClass(interview.type)">
                              {{ interview.type | titlecase }}
                            </span>
                          </td>
                          <td>
                            <span [class]="getStatusBadgeClass(interview.status)">
                              {{ interview.status | titlecase }}
                            </span>
                          </td>
                          <td>
                            <div>
                              <div>{{ formatDate(interview.scheduledAt) }}</div>
                              @if (interview.completedAt) {
                                <small class="text-success">
                                  Completed: {{ formatDate(interview.completedAt) }}
                                </small>
                              }
                            </div>
                          </td>
                          <td>{{ formatDuration(interview.duration) }}</td>
                          <td>
                            <div class="progress" style="height: 20px;">
                              <div 
                                class="progress-bar" 
                                [class]="interview.status === InterviewStatus.COMPLETED ? 'bg-success' : 
                                       interview.status === InterviewStatus.IN_PROGRESS ? 'bg-warning' : 'bg-secondary'"
                                [style.width.%]="getCompletionPercentage(interview)">
                                {{ getCompletionPercentage(interview) }}%
                              </div>
                            </div>
                          </td>
                          <td>
                            @if (interview.status === InterviewStatus.COMPLETED) {
                              <div>
                                <strong>{{ interview.totalScore }}/{{ interview.maxScore }}</strong>
                                <small class="d-block text-muted">
                                  {{ (interview.totalScore / interview.maxScore * 100) | number:'1.1-1' }}%
                                </small>
                              </div>
                            } @else {
                              <span class="text-muted">Pending</span>
                            }
                          </td>
                          <td>
                            <div class="btn-group btn-group-sm">
                              <button 
                                class="btn btn-outline-primary" 
                                (click)="viewInterview(interview)"
                                title="View Details">
                                <i class="bi bi-eye"></i>
                              </button>
                              @if (interview.status === InterviewStatus.SCHEDULED || interview.status === InterviewStatus.IN_PROGRESS) {
                                <button 
                                  class="btn btn-outline-danger" 
                                  (click)="cancelInterview(interview)"
                                  title="Cancel Interview">
                                  <i class="bi bi-x-circle"></i>
                                </button>
                              }
                            </div>
                          </td>
                        </tr>
                      }
                    </tbody>
                  </table>
                </div>
              } @else {
                <div class="text-center py-5">
                  <i class="bi bi-clipboard-data fs-1 text-muted"></i>
                  <h5 class="mt-3">No interviews found</h5>
                  <p class="text-muted">Try adjusting your filters to see more interviews.</p>
                  <button class="btn btn-primary" (click)="clearFilters()">
                    <i class="bi bi-funnel me-2"></i>
                    Clear Filters
                  </button>
                </div>
              }
            </div>
          </div>
        </div>
      </div>
    }
  </div>
</div>
